# 智能领域聊天机器人 — 用户使用手册

## 1. 系统简介

智能领域聊天机器人是一个基于大语言模型（LLM）的 AI 对话系统。它可以回答各类问题——日常聊天、常识百科、技术编程等均可；同时在**法律领域**配备了专业工具（知识库检索、法条查询、知识图谱、场景分析），能够提供准确、有依据的法律咨询。

**核心特点**：
- 通用对话 + 法律领域深度增强
- Agent 自主决策是否调用专业工具
- 推理过程透明可见

---

## 2. 访问系统

系统启动后，打开浏览器访问：

| 页面 | 地址 |
|------|------|
| 主界面 | http://localhost:3000 |
| API 文档 | http://localhost:8000/docs |

> 启动方法请参考 README.md 的「部署指南」或「一键启动」章节。

---

## 3. 界面布局

系统界面分为三栏布局：

```
┌─────────────── 顶部工具栏 ──────────────────┐
│  [系统名称]        [对话总结] [导出] [清空]   │
├──────┬──────────────────────┬────────────────┤
│      │                      │                │
│ 会话 │     聊天区域          │   分析面板     │
│ 列表 │                      │                │
│      │                      │                │
│      ├──────────────────────┤                │
│      │  [输入框]    [发送]   │                │
└──────┴──────────────────────┴────────────────┘
```

### 3.1 左侧：会话列表

- **新建会话**：点击右上角的 `+` 按钮创建新会话
- **切换会话**：点击任意会话条目切换到该会话
- **删除会话**：鼠标悬停会话条目，点击红色删除按钮
- 会话数据保存在浏览器本地存储（localStorage），刷新页面不丢失

### 3.2 中间：聊天区域

聊天区域是主要的交互区域，包括消息列表和输入框。

**发送消息**：
- 在底部输入框输入问题，点击「发送」按钮或按 `Enter` 键发送
- `Shift + Enter` 可以换行输入

**消息类型**：
- **用户消息**：蓝色气泡，显示在右侧
- **系统回答**：灰色气泡，显示在左侧

**Agent 推理过程**：当系统调用了法律工具时，回答上方会显示绿色的「Agent 推理过程」面板，展示：
- 调用了哪些工具（知识库检索 / 法条查询 / 知识图谱 / 场景分析）
- 每个工具的执行结果摘要（如"找到 5 条相关法律资料"）

**来源标注**：如果回答引用了知识库中的法律资料，消息底部会显示「参考来源」标签，标注引用领域和相关度。

### 3.3 右侧：分析面板

分析面板展示系统运行状态和当前对话的分析信息：

**系统状态**：
- **服务状态**：显示后端是否正常运行（正常 / 离线）
- **法律知识库**：显示 RAG 知识库是否加载及文档数量
- **Agent 模型**：显示当前使用的大模型名称（如 qwen-plus）

**Agent 工具**：列出 Agent 可用的 4 个工具：
- 知识库检索 — 从向量知识库搜索法律资料
- 法条查询 — 精确查询特定法条内容
- 知识图谱 — 查询法律概念间的关系
- 场景分析 — 分析法律场景，提取关键事实

**本轮分析**：展示最近一次对话中 Agent 的详细行为：
- 调用了哪个工具
- 工具的输入参数
- 工具的执行结果

**评价反馈**：
- 1-5 星评分
- 文字评论
- 点击「提交反馈」发送

---

## 4. 使用场景

### 4.1 法律咨询

直接描述你的法律问题，系统会自动调用专业工具：

**示例问题**：
- "我被公司辞退了，工作了3年，能拿到多少赔偿？"
- "离婚时财产怎么分割？"
- "劳动合同法第四十七条规定了什么？"
- "交通事故对方全责，我该怎么索赔？"

系统会自动：
1. 识别这是法律问题
2. 调用知识库检索相关法律资料
3. 结合检索到的法律依据生成专业回答
4. 在回答末尾附上免责声明

### 4.2 通用对话

非法律问题直接由大模型回答，不调用法律工具：

**示例问题**：
- "Python 和 Java 哪个更适合初学者？"
- "帮我写一首关于春天的诗"
- "1+1等于几？"
- "今天是星期几？"

### 4.3 多轮对话

系统支持多轮对话上下文。你可以在一个会话中连续追问：

```
用户: 我在公司工作了5年被辞退了
机器人: [调用知识库检索] 根据劳动合同法...
用户: 那如果公司不给赔偿怎么办？
机器人: [基于上下文继续回答] 如果公司拒绝...
用户: 我需要准备什么材料去仲裁？
机器人: [继续深入回答]...
```

---

## 5. 顶部工具栏功能

### 5.1 对话总结

点击「对话总结」按钮，系统会自动生成当前对话的摘要总结，方便回顾。

### 5.2 导出对话

点击「导出对话」按钮，将当前会话的所有消息导出为 JSON 文件，保存到本地。文件名格式：`对话记录_YYYY-MM-DD.json`。

### 5.3 清空对话

点击「清空」按钮，清除当前会话的所有聊天记录，恢复到初始欢迎状态。操作前会弹出确认对话框。

---

## 6. 常见问题

### Q: 系统显示"服务状态: 离线"

请确认后端已启动。在终端运行：
```bash
python -m uvicorn api.main:app --host 127.0.0.1 --port 8000
```

### Q: 法律知识库显示"未加载"

知识库需要先构建。请参考 README.md 的第 6、7 步下载模型和构建知识库。没有知识库时系统仍可使用，但法律问题的回答将不会引用具体法条。

### Q: 回答速度比较慢

回答速度取决于大模型 API 的响应时间，通常 2-5 秒。如果 Agent 调用了多个工具，可能需要更长时间。这是正常现象。

### Q: 切换会话后之前的聊天记录不见了

会话数据保存在浏览器的 localStorage 中。清除浏览器缓存或换浏览器会导致数据丢失。如需保留，请使用「导出对话」功能。

### Q: 能问非法律问题吗？

可以。系统是通用型 AI 助手，任何问题都可以问。法律问题会自动调用专业工具增强回答，非法律问题由大模型直接回答。
